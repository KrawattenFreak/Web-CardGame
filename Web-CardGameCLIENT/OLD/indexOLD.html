<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
</head>

<style>
    

    .karten-section img, .cardPlace, .cardPlaceholder, #hidden-section img {
        width: 140px;
        height: 210px;
        
    }

    


    .cardPlace:hover {
        cursor: grab;
    }

    .cardPlace {
        position: absolute;
        
    }

    .cardPlace img {
        -webkit-user-select: none;
        -khtml-user-select: none;
        -moz-user-select: none;
        -o-user-select: none;
        user-select: none;

        -webkit-user-drag: none; 
        -khtml-user-drag: none; 
        -moz-user-drag: none; 
        -o-user-drag: none; 

    }
    
    .karten-section {
        display: flex;
        flex-wrap: wrap;  
        justify-content: center;
        margin-top: 200px;
    }

    .cardPlaceholder {
        border-style: solid;
        border-color: rgb(41, 41, 41);
        border-radius: 7px;
        margin: 0 6px;
        box-shadow: 0px 5px 10px rgb(39, 39, 39);
        margin-bottom: 30px;
    }

    #players {
        font-family: 'Gill Sans', 'Gill Sans MT', Calibri, 'Trebuchet MS', sans-serif;
    }



/*--------------------*/
    body {
        background-image: url(./images/WaitScreenBackground.png);
        margin: 0;
        padding: 0;

        -webkit-text-size-adjust: 100%;
        -webkit-font-smoothing: antialiased;
    }

    h1, p {
        font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        padding: 0px;
        margin: 0px;
    }

    h1 {
        color:white;
        padding-bottom: 4px;
    }

    .head {
        height: 70px;
        background-color: rgb(27, 27, 27);
        display: flex;
        justify-content: center;
        align-items: center;
    }

    .startscreenbox {
        margin: 0 auto;
        height: 400px;
        display: flex;
        flex-wrap: wrap;
        justify-content: center;
        align-items: center;
        box-shadow: 0px 0px 10px grey;
        background-color: rgba(255, 255, 255, 0.9);
    }

    .trennstrich {
        width: 1px;
        height: 100px;
        background-color: rgb(179, 179, 179);
        margin-right: 100px;
        margin-left: 100px;
    }

    button {
        background-color: rgb(2, 85, 180);
        border: none;
        color: white;
        padding: 10px;
        border-radius: 4px;
        box-shadow: 0 5px 30px rgb(170, 170, 170);
    }

    .title2 {
        font-size: 40px;
        margin-bottom: 20px;
    }

    .section1 {
        width: 30%;
        
    }

    .divGameId {

        border-radius: 4px;
        background-color: rgb(223, 223, 223);
        margin-top: 15px;
        box-shadow: inset 0 0 10px #bdbdbd;
        text-align: center;
    }

    .gameKey {
        margin-top: 15px;
    }

    #pgameid {
        padding: 10px;
    }

    input {
        border: none;
        background-color: rgb(231, 231, 231);
        padding: 10px;
        width: 100%;
        margin-bottom: 5px;
        box-shadow: inset 0 0 10px #bdbdbd;
    }

    button:hover {
        cursor: pointer;
    }

    


    /* set invisible */ 

    #gameUI {
        visibility: hidden;
        background-color: rgba(255, 255, 255, 0.9);
        display: flex;
    }

    .UIsection1 {
        padding: 20px;
        text-align: left;
        width: 50%;
    }

    .header-console {
        color: gray;
        margin-top: 20px;
        margin-bottom: 4px;
    }

    .UIsection1 div {
        margin-right: 10px;
        margin-bottom: 10px;
    }

    #players {
        display: flex;
        flex-wrap: wrap;
    }

    .UIsection2 {
        width: 50%;
    }


    #btnFinishRound {
        visibility: hidden;
        margin-top: 20px;
    }


    #karten-section {
        visibility: hidden;
    }

    .oneplayer {
        margin-top: 10px;
        background-color: white;
        border-radius: 10px;
        box-shadow: inset 0 0 10px #2a2a2a;
        text-align: center;
    }


    #triggerCard7, #triggerCard8 {
        margin-left: 50px;
        margin-right: 50px;
        border-color: rgb(202, 202, 202);
        box-shadow: inset 0 0 10px #2a2a2a;
        background-color: white;
    }

    #pTagPlayers {
        font-size: 30px;
        color: rgb(0, 0, 0);
        margin-top: 20px;
    }

    #btnstartGame {
        margin-bottom: 20px;
    }


    #cardPlace9 {
        visibility: hidden;
    }

    #hidden-section {
        display: flex;
        justify-content: center;
    }

    #console {
        display: flex;
        flex-direction: column;
        align-items: baseline;
        background-color: rgb(235, 235, 235);
        width: 90%;
        height: 150px;
        overflow: auto;
        box-shadow: inset 0 0 10px #bdbdbd;
        padding: 20px;
        box-sizing: border-box;
        

    }

    #failed {
        margin-bottom: 10px;
    }


    @media only screen and (min-width: 900px) {
        .UIsection1 {
            width: 100%;
            padding: 30px 80px;
        }
        
        .UIsection2 {
            width: 400px;
        }


    }



</style>


<body>

    <div class="wrapper">
        <div class="head">
            <h1>Card Game</h1>
        </div>

        
        <div id="startscreenbox" class="startscreenbox">
            <div class="section1">
                <p class="title2">Spiel erstellen</p>
            
                

                <button id = 'btnCreate'>New Game</button>
                
                <p class="gameKey">Dein Game-Key:</p>
                <div class="divGameId">
                    <p id = 'pgameid'> Noch kein Spiel erstellt.</p>
                </div>

                
            </div>

            <div class="trennstrich">

            </div>

            <div class="section1">
                <p class="title2">Spiel beitreten</p>

                <input id = 'iptUsername' type="text" placeholder="Username">
                <input id = 'iptGameId' type="text" placeholder="Game-ID">

                <p id="failed"></p>
                

                <button id = 'btnJoin'>Join</button>
                
                
            </div>
        </div>

        <div id = 'gameUI'>
            
            


            <div class="UIsection1">
                <p id="pTagPlayers"><b>Mitspieler</b></p>

                <div id = "players"></div>

                <button id = "btnFinishRound">Finish</button>

                <hr style="width: 100px; margin-left: 0;">

                <button id = 'btnstartGame'> Start Game </button>
            </div>

            <div class="UIsection2">

                <p class="header-console">Konsole:</p>

                <div id="console">

                </div>


            </div>

        </div>

        <div id="hidden-section">
            <div id="cardPlace9" class="cardPlace"> 
                <img id= "pic9" src="">
            </div>
        </div>
        
        <div id="karten-section" class="karten-section">

            <div class="cardPlaceholder" id="triggerCard0">
                <div id="cardPlace0" class="cardPlace"> 
                    <img id= "pic0" src="" draggable="false">
                </div>
            </div>

            <div class="cardPlaceholder" id="triggerCard1">
                <div id="cardPlace1" class="cardPlace"> 
                    <img id= "pic1" src="">
                </div>
            </div>

            <div class="cardPlaceholder" id="triggerCard2">
                <div id="cardPlace2" class="cardPlace"> 
                    <img id= "pic2" src="">
                </div>
            </div>

            <div class="cardPlaceholder" id="triggerCard3">
                <div id="cardPlace3" class="cardPlace"> 
                    <img id= "pic3" src="">
                </div>
            </div>

            <div class="cardPlaceholder" id="triggerCard4">
                <div id="cardPlace4" class="cardPlace"> 
                    <img id= "pic4" src="">
                </div>
            </div>

            <div class="cardPlaceholder" id="triggerCard5">
                <div id="cardPlace5" class="cardPlace"> 
                    <img id= "pic5" src="">
                </div>
            </div>

            <div class="cardPlaceholder" id="triggerCard6">
                <div id="cardPlace6" class="cardPlace"> 
                    <img id= "pic6" src="">
                </div>
            </div>

            <div class="cardPlaceholder" id="triggerCard7">
                <div id="cardPlace7" class="cardPlace"> 
                    <img id= "pic7" src="">
                </div>
            </div>

            <div class="cardPlaceholder" id="triggerCard8">
                <div id="cardPlace8" class="cardPlace"> 
                    <img id= "pic8" src="">
                </div>
            </div>


        </div>
    </div>
    


    <script>
        //HTML elements
        let cards = [];
        let cardsSaved = [false, false, false, false, false, false, false, false, false];
        let inGame = false;
        let clientId = null;
        let gameId = null;
        let maxVisibleProg = 2000;
        let bistAuserwählt = false;
        let ws = new WebSocket("wss://localhost:9090")
        const btnCreate = document.getElementById("btnCreate");
        const btnJoin = document.getElementById("btnJoin");
        const btnFinishRound = document.getElementById("btnFinishRound");
        const txtUsername = document.getElementById("iptUsername");
        const txtGameId = document.getElementById("iptGameId");
        const divPlayers = document.getElementById("players");
        const startGame = document.getElementById('startGame');
        const consoleOutput = document.getElementById('console');

        


        let game = null;

        //wiring events
        btnCreate.addEventListener("click", e => {

            const payLoad = {
                "method": "create",
                "clientId": clientId
            }

            ws.send(JSON.stringify(payLoad));
        })

        btnJoin.addEventListener("click", e => {

            const username = txtUsername.value;
            
            gameId = txtGameId.value;

            const payload = {
                "method": "join",
                "clientId": clientId,
                "gameId": gameId,
                "username": username
            }

            ws.send(JSON.stringify(payload));

        })

        btnstartGame.addEventListener("click", e => {

            const payload = {
                "method": "startGame",
                "gameId": gameId,
            }

            ws.send(JSON.stringify(payload));

        })

        btnFinishRound.addEventListener("click", e => {
                if (bistAuserwählt == true) {
                    const payLoad = {
                        "method": "finishedRound",
                        "gameId": gameId,
                        "clientId": clientId
                        
                    }

                    document.getElementById("btnFinishRound").style.visibility = "hidden"; 
                    ws.send(JSON.stringify(payLoad));
                    console.log("GESENDET!");
                } else {
                    console.log("Du bist nicht dran!");
                }

                bistAuserwählt = false;
                    
            })


        
        ws.onmessage = message => {
            //message.data 
            const response = JSON.parse(message.data);
            //connect
            if(response.method === "connect") {
                clientId = response.clientId;
                console.log("Client Id set successfully " + clientId);
            }

            //create
            if (response.method === "create") {

                console.log("Game successfully created with Id " + response.game.id + ".");
                gameId = response.game.id;
                document.getElementById("pgameid").innerHTML = response.game.id;

            }

            //join

            if (response.method === "joinRES") {
                if (response.valid == false) {
                    console.log("Du bist echt kernbehindert");
                    document.getElementById("failed").textContent = "Der Code ist ungültig.";
                    document.getElementById("failed").style.color = "red";

                }

                if (response.valid == true) {
                    document.getElementById("startscreenbox").remove();
                    document.getElementById("gameUI").style.visibility = "visible"; 
                }


            }



            if (response.method === "join") {
                game = response.game;

                while(divPlayers.firstChild)
                divPlayers.removeChild(divPlayers.firstChild)

                game.clients.forEach (c => {
                    

                    //building a Child inside of Playerlist
                    const d = document.createElement("div");
                    d.style.width = "200px";
                    d.setAttribute("id", c.clientId);
                    d.setAttribute("class", "oneplayer");

                    const t = document.createElement("p");
                    t.textContent = c.username;
                    d.appendChild(t);
                    
                    c.divCard = d;
                    divPlayers.appendChild(d);

                    const p = document.createElement("progress");
                    d.appendChild(p);
                    p.setAttribute("id", c.clientId+"progress");

                })


            }

            if (response.method === "leave") {
                const game = response.game;

                while(divPlayers.firstChild)
                divPlayers.removeChild(divPlayers.firstChild)

                game.clients.forEach (c => {
                    

                    
                    //building a Child inside of Playerlist
                    const d = document.createElement("div");
                    d.style.width = "200px";
                    d.setAttribute("id", c.clientId);
                    d.setAttribute("class", "oneplayer");

                    const t = document.createElement("p");
                    t.textContent = c.username;
                    d.appendChild(t);
                    
                    c.divCard = d;
                    divPlayers.appendChild(d);

                    const p = document.createElement("progress");
                    d.appendChild(p);
                    p.setAttribute("id", c.clientId+"progress");
                })

                console.log(game.clients);

            }

            if (response.method === "startGame") {

                cards = response.cards;
                const startHealth = response.startHealth;
                document.getElementById("karten-section").style.visibility = "visible";  
                btnstartGame.remove();
                document.body.style.backgroundImage = "url(./images/Hintergrundbild.png)"
                GAME(startHealth);
            }

            if (response.method === "attack") {
                if(inGame == true) {

                    game.clients.forEach (c => {
                        if (c.clientId == response.target) {
                            c.health -= response.damage;
                            document.getElementById(c.clientId+"progress").setAttribute("value", c.health);

                            if(response.isDeath == true ) {
                                document.getElementById(c.clientId+"progress").setAttribute("value", 0);
                                document.getElementById(c.clientId+"progress").style.backgroundColor = "red";
                            }

                        }
                    })
                }
                
            }

            if (response.method === "amZug") {
                
                const currentGameClients = response.clients
                
                //console.log(currentGameClients);


                currentGameClients.forEach(c => {
                    //console.log(c.clientId);
                    document.getElementById(c.clientId).style.background = "blue";
                }) 
                    


                document.getElementById(response.player).style.backgroundColor = "green";

                

                if (clientId == response.player) {
                    bistAuserwählt = true;
                    //console.log("DU BIST AUSERWÄHLT");
                    document.getElementById("btnFinishRound").style.visibility = "visible";   
                    
                    //console.log(cards);

                    cards[7] = response.getCard;
                    document.getElementById("pic7").style.visibility = "visible";
                    document.getElementById("pic7").src="./images/KarteZiehen.png";
                    
                    
                    if(response.specialCard == true) {
                        console.log("Du hast eine Special Karte erhalten!");

                        cards[8] = "DemoKarte_" + response.specialCardId;
                        document.getElementById("pic8").style.visibility = "visible";
                        document.getElementById("pic8").src="./images/KarteZiehen2.png";

                    }

                }
            } if (response.method === "thieftarget") {

                const validCardsForThief = [];
                const stehlendeCardGlobal = null;

                let thiefCardAvailable = false;
                console.log("vor PayLoad " + thiefCardAvailable)

                for (let i = 0; i < 7; i++) {
                    if(cards[i] != null && cardsSaved[i] == false) {
                        validCardsForThief.push([cards[i], i]);
                        thiefCardAvailable = true;
                        console.log("AUSGEFÜHRT")
                    }
                }

                const stehlendeKarte = Math.floor(Math.random() * (0 - validCardsForThief.length)) + validCardsForThief.length;

                
                
                if(thiefCardAvailable == true) {
                    const payLoad = {
                        "method": "thiefResClient",
                        "card": cards[validCardsForThief[stehlendeKarte][1]],
                        "game": gameId,
                        "CardWasAvailable": true
                    }
                    ws.send(JSON.stringify(payLoad));

                    cards[validCardsForThief[stehlendeKarte][1]] = null;

                } else {
                    const payLoad = {
                        "method": "thiefResClient",
                        "game": gameId,
                        "CardWasAvailable": false
                    }
                    ws.send(JSON.stringify(payLoad));
                }

                console.log("nach PayLoad " + thiefCardAvailable)
                

                

                aktualisierung();

            } if (response.method === "thiefResToSender") {
                //console.log("Die Karte, die du bekommst, ist " + response.receivedCard)


                cards[9] = response.receivedCard;
                document.getElementById("pic"+9).src="./images/" + cards[9] + ".png";
                aktualisierung();
                
                ausgewaelteCard = 9;
                CardMoving();

            } if (response.method === "spentCard") {

                if(cardclickstate == 1) {
                    cards[ausgewaelteCard] = response.card;
                    document.getElementById("pic"+ausgewaelteCard).src="./images/" + cards[ausgewaelteCard] + ".png";


                }else {

                    cards[9] = response.card;
                    document.getElementById("pic"+9).src="./images/" + cards[9] + ".png";
                    aktualisierung();
                    
                    ausgewaelteCard = 9;
                    CardMoving();
                }
            
            } if (response.method === "healMax") {

                document.getElementById(response.target+"progress").setAttribute("max", response.maxhealth);

            } if (response.method === "revived") {

                game.clients.forEach (c => {
                    if(c.clientId == response.target) {
                        c.health = 200;
                    }
                })

                document.getElementById(response.target+"progress").setAttribute("value", 200);
                document.getElementById(response.target+"progress").style.removeProperty('background-color');

            } if (response.method === "consoleOutput") {

                const scrollToBottom = (node) => {
                	node.scrollTop = node.scrollHeight;
                }


                const p = document.createElement("p");
                p.textContent = response.message;
                p.style.color = response.color;
                consoleOutput.appendChild(p);

                scrollToBottom(consoleOutput);
                
            } if (response.method === "showCardsBecauseSpion") {

                const payLoad = {
                    "method": "ForSpionResponse",
                    "cards": cards,
                    "game": gameId
                }

                ws.send(JSON.stringify(payLoad));
            }

        }



//------------------------------------

    let ausgewaelteCard = null;
    let targetField = null;
    let cardclickstate = 0;
    let ausgewaelteCardSelected = false;

    function GAME(startHealth) {

        inGame = true;


        const cardDictionary = {
            "DemoKarte_0": {
                "DemoKarte_1": "DemoKarte_12",
                "DemoKarte_9": "DemoKarte_11"
            },
            "DemoKarte_1": {
                "DemoKarte_0": "DemoKarte_12",
                "DemoKarte_11": "DemoKarte_13"
            },
            "DemoKarte_2": {
                "DemoKarte_3": "DemoKarte_16"
            },
            "DemoKarte_3": {
                "DemoKarte_2": "DemoKarte_16",
                "DemoKarte_21": "DemoKarte_27"
            },
            "DemoKarte_4": {
                "DemoKarte_16": "DemoKarte_17",
                "DemoKarte_17": "DemoKarte_25",
                "DemoKarte_5": "DemoKarte_18"
            },
            "DemoKarte_5": {
                "DemoKarte_4": "DemoKarte_18",
                "DemoKarte_6": "DemoKarte_20"
            },
            "DemoKarte_6": {
                "DemoKarte_18": "DemoKarte_19",
                "DemoKarte_5": "DemoKarte_20",
                "DemoKarte_22": "DemoKarte_23"
            },
            "DemoKarte_7": {
                "DemoKarte_8": "DemoKarte_22"
            },
            "DemoKarte_8": {
                "DemoKarte_7": "DemoKarte_22"
            },
            "DemoKarte_9": {
                "DemoKarte_0": "DemoKarte_11"
            },
            "DemoKarte_10": {
                "DemoKarte_12": "DemoKarte_14"
            },
            "DemoKarte_11": {
                "DemoKarte_1": "DemoKarte_13"
            },
            "DemoKarte_12": {
                "DemoKarte_10": "DemoKarte_14"
            },
            "DemoKarte_13": {
                "DemoKarte_14": "DemoKarte_15"
            },
            "DemoKarte_14": {
                "DemoKarte_13": "DemoKarte_15"
            },
            "DemoKarte_15": {
                "DemoKarte_26": "DemoKarte_28"
            },
            "DemoKarte_16": {
                "DemoKarte_4": "DemoKarte_17"
            },
            "DemoKarte_17": {
                "DemoKarte_4": "DemoKarte_25"
            },
            "DemoKarte_18": {
                "DemoKarte_6": "DemoKarte_19",
                "DemoKarte_23": "DemoKarte_24"
            },
            "DemoKarte_19": {
                "DemoKarte_25": "DemoKarte_26",
                "DemoKarte_20": "DemoKarte_21"
            },
            "DemoKarte_20": {
                "DemoKarte_19": "DemoKarte_21"
            },
            "DemoKarte_21": {
                "DemoKarte_3": "DemoKarte_28"
            },
            "DemoKarte_22": {
                "DemoKarte_6": "DemoKarte_23"
            },
            "DemoKarte_23": {
                "DemoKarte_18": "DemoKarte_24"
            },
            "DemoKarte_24": {
                "DemoKarte_27": "DemoKarte_28"
            },
            "DemoKarte_25": {
                "DemoKarte_19": "DemoKarte_26"
            },
            "DemoKarte_26": {
                "DemoKarte_15": "DemoKarte_28"
            },
            "DemoKarte_27": {
                "DemoKarte_24": "DemoKarte_28"
            }



        }



        aktualisierung();

        //States: 
        // 0 = Auswählen zum Herumbewegen
        // 1 = Auswählen der Karte um sie zu plazieren


        const card = [
            document.getElementById("cardPlace0"),
            document.getElementById("cardPlace1"),
            document.getElementById("cardPlace2"),
            document.getElementById("cardPlace3"),
            document.getElementById("cardPlace4"),
            document.getElementById("cardPlace5"),
            document.getElementById("cardPlace6"),
            document.getElementById("cardPlace7"),
            document.getElementById("cardPlace8")
        ]

        const triggercard = [
            document.getElementById("triggerCard0"),
            document.getElementById("triggerCard1"),
            document.getElementById("triggerCard2"),
            document.getElementById("triggerCard3"),
            document.getElementById("triggerCard4"),
            document.getElementById("triggerCard5"),
            document.getElementById("triggerCard6"),
            document.getElementById("triggerCard7"),
            document.getElementById("triggerCard8")
        ]




        card[0].addEventListener("click", function () {
            if (cardclickstate == 0) {
                ausgewaelteCard = 0;
                CardAngeklickt();
            }

        })

        card[1].addEventListener("click", function () {
            if (cardclickstate == 0) {
                ausgewaelteCard = 1;
                CardAngeklickt();
            }
        })

        card[2].addEventListener("click", function () {
            if (cardclickstate == 0) {
                ausgewaelteCard = 2;
                CardAngeklickt();
            }
        })

        card[3].addEventListener("click", function () {
            if (cardclickstate == 0) {
                ausgewaelteCard = 3;
                CardAngeklickt();
            }
        })

        card[4].addEventListener("click", function () {
            if (cardclickstate == 0) {    
                ausgewaelteCard = 4;
                CardAngeklickt();
            }
        })

        card[5].addEventListener("click", function () {
            if (cardclickstate == 0) {
                ausgewaelteCard = 5;
                CardAngeklickt();
            }
        })

        card[6].addEventListener("click", function () {
            if (cardclickstate == 0) {
                ausgewaelteCard = 6;
                CardAngeklickt();
            }
        })

        card[7].addEventListener("click", function () {
            if (cardclickstate == 0 && bistAuserwählt == true) {
                if(cards[7] != null) {
                    document.getElementById("pic7").src="./images/" + cards[7] + ".png";
                    ausgewaelteCard = 7;
                    CardAngeklickt();
                }
            }
        })

        card[8].addEventListener("click", function () {
            if (cardclickstate == 0 && bistAuserwählt == true) {
                if(cards[8] != null) {
                    document.getElementById("pic8").src="./images/" + cards[8] + ".png";
                    ausgewaelteCard = 8;
                    CardAngeklickt();
                }
            }
        })



    //Triggercards

        triggercard[0].addEventListener("click", function () {
            if (cardclickstate == 1) {
                targetField = 0;
                CardTriedToPlace();
            }
        })

        triggercard[1].addEventListener("click", function () {
            if (cardclickstate == 1) {
                targetField = 1;
                CardTriedToPlace();
            }
        })

        triggercard[2].addEventListener("click", function () {
            if (cardclickstate == 1) {
                targetField = 2;
                CardTriedToPlace();
            }
        })

        triggercard[3].addEventListener("click", function () {
            if (cardclickstate == 1) {
                targetField = 3;
                CardTriedToPlace();
            }
        })

        triggercard[4].addEventListener("click", function () {
            if (cardclickstate == 1) {    
                targetField = 4;
                CardTriedToPlace();
            }
        })

        triggercard[5].addEventListener("click", function () {
            if (cardclickstate == 1) {
                targetField = 5;
                CardTriedToPlace();
            }
        })

        triggercard[6].addEventListener("click", function () {
            if (cardclickstate == 1) {
                targetField = 6;
                CardTriedToPlace();
            }
        })

        game.clients.forEach (c => {
            c.divCard.style.background = "blue";
            c.divCard.style.color = "white";
            

            c.health = startHealth;
            document.getElementById(c.clientId+"progress").setAttribute("max", maxVisibleProg);
            document.getElementById(c.clientId+"progress").setAttribute("value", c.health);
            
     
            c.divCard.addEventListener("click", e => { 
                if(cardclickstate == 1) {
                    //console.log("Angriff auf " + c.username + ".");

                    console.log(cards)

                    if(c.health > 0) {
                    if(cards[ausgewaelteCard] !== "DemoKarte_-6"){


                        if(cards[ausgewaelteCard] == "DemoKarte_-2") {
                        
                            
                            let spentCardAusgewaehlt = prompt("Welche Karte möchtest du versenden? (1 - 7)", "");
                            if(spentCardAusgewaehlt === null) {
                                //AUF CANCEL GEKLICKT

                            } else {
                                if (cards[spentCardAusgewaehlt-1] !== null) {
                                    //KARTENPLATZ WAR LEER, DESHALB NICHT VERSENDUNG

                                    const payload = {
                                        "method": "attack",
                                        "card": cards[ausgewaelteCard],
                                        "target": c.clientId,
                                        "game": gameId,
                                        "sender": clientId,
                                        "spentCard": cards[spentCardAusgewaehlt-1]
                                    }

                                    ws.send(JSON.stringify(payload));

                                    cards[spentCardAusgewaehlt-1] = null;
                                    cards[ausgewaelteCard] = null;

                                }
                            }


                        } else if(cards[ausgewaelteCard] == "DemoKarte_-1") {

                            const payload = {
                                "method": "attack",
                                "card": cards[ausgewaelteCard],
                                "target": c.clientId,
                                "game": gameId,
                                "sender": clientId
                            }

                            ws.send(JSON.stringify(payload));
                            cards[ausgewaelteCard] = null;


                        } else if(cards[ausgewaelteCard] == "DemoKarte_-3") {

                            const payload = {
                                "method": "attack",
                                "card": cards[ausgewaelteCard],
                                "target": c.clientId,
                                "game": gameId,
                                "sender": clientId
                            }
                            
                            ws.send(JSON.stringify(payload));
                            cards[ausgewaelteCard] = null;

                        } else if(cards[ausgewaelteCard] == "DemoKarte_-10") {

                            const payload = {
                                "method": "attack",
                                "card": cards[ausgewaelteCard],
                                "target": c.clientId,
                                "game": gameId,
                                "sender": clientId
                            }

                            ws.send(JSON.stringify(payload));
                            cards[ausgewaelteCard] = null;

                        } else if(cards[ausgewaelteCard] == "DemoKarte_-11") {

                            const payload = {
                                "method": "attack",
                                "card": cards[ausgewaelteCard],
                                "target": c.clientId,
                                "game": gameId,
                                "sender": clientId
                            }

                            ws.send(JSON.stringify(payload));
                            cards[ausgewaelteCard] = null;
                        


                        } else if(cards[ausgewaelteCard] == "DemoKarte_-5") {

                            const payload = {
                                "method": "attack",
                                "card": cards[ausgewaelteCard],
                                "target": c.clientId,
                                "game": gameId,
                                "sender": clientId
                            }

                            ws.send(JSON.stringify(payload));
                            cards[ausgewaelteCard] = null;


                        } else if(cards[ausgewaelteCard] == "DemoKarte_-4") {

                            const payload = {
                                "method": "attack",
                                "card": cards[ausgewaelteCard],
                                "target": c.clientId,
                                "game": gameId,
                                "sender": clientId
                            }

                            ws.send(JSON.stringify(payload));
                            cards[ausgewaelteCard] = null;


                        } else if(cards[ausgewaelteCard] == "DemoKarte_-9") {

                            const payload = {
                                "method": "attack",
                                "card": cards[ausgewaelteCard],
                                "target": c.clientId,
                                "game": gameId,
                                "sender": clientId
                            }

                            ws.send(JSON.stringify(payload));
                            cards[ausgewaelteCard] = null;

                        
                        } else if(cards[ausgewaelteCard] == "DemoKarte_-7") {

                            const payload = {
                                "method": "attack",
                                "card": cards[ausgewaelteCard],
                                "target": c.clientId,
                                "game": gameId,
                                "sender": clientId
                            }

                            ws.send(JSON.stringify(payload));
                            cards[ausgewaelteCard] = null;



                            //WENN GANZ NORMALE ANGRIFFSKARTE
                        } else if(cards[ausgewaelteCard].slice(10, 11) !== "-") {
                            const payload = {
                                "method": "attack",
                                "card": cards[ausgewaelteCard],
                                "target": c.clientId,
                                "game": gameId,
                                "sender": clientId
                            }

                            ws.send(JSON.stringify(payload));
                            cards[ausgewaelteCard] = null;
                        }


                        

                        document.getElementById('cardPlace' + ausgewaelteCard).style.pointerEvents = "all";
                        ausgewaelteCardSelected = false;
                        document.getElementById('cardPlace' + ausgewaelteCard).style.zIndex = "1";
                        document.getElementById('cardPlace' + ausgewaelteCard).style.removeProperty('left');
                        document.getElementById('cardPlace' + ausgewaelteCard).style.removeProperty('top');

                        

                        aktualisierung();

                        //console.log(cards);

                        cardclickstate = 0;

                    }
                    } else if(c.health <= 0) {
                    
                        if(cards[ausgewaelteCard] == "DemoKarte_-6") {

                            console.log("JAO");
                            const payload = {
                                "method": "attack",
                                "card": cards[ausgewaelteCard],
                                "target": c.clientId,
                                "game": gameId,
                                "sender": clientId
                            }
    //
                            ws.send(JSON.stringify(payload));
                            cards[ausgewaelteCard] = null;
                        } 

                        

                        document.getElementById('cardPlace' + ausgewaelteCard).style.pointerEvents = "all";
                        ausgewaelteCardSelected = false;
                        document.getElementById('cardPlace' + ausgewaelteCard).style.zIndex = "1";
                        document.getElementById('cardPlace' + ausgewaelteCard).style.removeProperty('left');
                        document.getElementById('cardPlace' + ausgewaelteCard).style.removeProperty('top');

                        

                        aktualisierung();

                        //console.log(cards);

                        cardclickstate = 0;
                

                    }

                }
            })
        })


    // FUNKTIONEN



        function CardAngeklickt() {
            if(cards[ausgewaelteCard] != null) {

                CardMoving();

                
            } else {
                console.log("Da ist keine Karte.");
            }
        }

        


        function CardTriedToPlace() {

            let commonFound = false;

            document.getElementById('cardPlace' + ausgewaelteCard).style.pointerEvents = "all";


            if(targetField != ausgewaelteCard) {

                
                for (c in cardDictionary[cards[ausgewaelteCard]]) {
                    if(c == cards[targetField]) {
                        cards[targetField] = cardDictionary[cards[ausgewaelteCard]][cards[targetField]];
                        commonFound = true;
                    
                    } else {
                        
                    }

                }

                console.log(cards[ausgewaelteCard])
                console.log(cards[targetField])


                if (commonFound == false) {
                    

                    if(cards[ausgewaelteCard] == cards[targetField]) {
                        cards[targetField] = "DemoKarte_-3";
                        console.log(cards[targetField])

                    } else if(cards[ausgewaelteCard] == "DemoKarte_-8" && cards[targetField] !== null) {

                        document.getElementById("cardPlace" + targetField).style.opacity = "0.5";
                        cardsSaved[targetField] = true;
                        
                        

                    } else {
                        cards[targetField] = cards[ausgewaelteCard];

                        cardsSaved[targetField] = cardsSaved[ausgewaelteCard];
                        cardsSaved[ausgewaelteCard] = false;

                        console.log(cardsSaved)
                    }
                    
                } else {
                    commonFound = false;
                }

                cards[ausgewaelteCard] = null;


            } else {

            }

            


            ausgewaelteCardSelected = false;
            document.getElementById('cardPlace' + ausgewaelteCard).style.zIndex = "1";
            document.getElementById('cardPlace' + ausgewaelteCard).style.removeProperty('left');
            document.getElementById('cardPlace' + ausgewaelteCard).style.removeProperty('top');

            aktualisierung();
            //console.log(cards);

            cardclickstate = 0;


        }


    }

    function aktualisierung() {
            for (let i = 0; i< 10 ; i++) {
                if(cards[i] != null) {
                    document.getElementById("pic"+i).style.visibility = "visible";

                    

                    if(i<7) {
                        document.getElementById("pic"+i).src="./images/" + cards[i] + ".png";
                    }
               
                } else {
                    //console.log("An Stelle " + i + " befindet sich keine Karte und wird deaktiviert.");
                    document.getElementById("pic"+i).style.visibility = "hidden";
                }

            }

            for (let i = 0; i< 7 ; i++) {

                if(cardsSaved[i] == true) {
                    document.getElementById("cardPlace" + i).style.opacity = "0.5";
                }
                if(cardsSaved[i] == false) {
                    document.getElementById("cardPlace" + i).style.opacity = "1";
                }


            }
    }

    function CardMoving() {
            ausgewaelteCardSelected = true;

            document.getElementById('cardPlace' + ausgewaelteCard).style.cursor = "grabbing";
            document.getElementById('cardPlace' + ausgewaelteCard).style.pointerEvents = "none";
            document.getElementById('cardPlace' + ausgewaelteCard).style.zIndex = "100";
    
    
            document.addEventListener('mousemove', function(ev){
            
                //ÜBERGANGSLÖSUNG
                if(ausgewaelteCardSelected == true) {
                    
                    document.getElementById('cardPlace' + ausgewaelteCard).style.top = ev.clientY - 105 +  "px";
                    document.getElementById('cardPlace' + ausgewaelteCard).style.left = ev.clientX - 70 + "px";
                    //ÜBERGANGSLÖSUNG
                    cardclickstate = 1;
                }
            
            });
        }



    

    </script>

</body>
</html>